---
// MobileMenu.astro - Hamburger menu for mobile navigation
// Wire to toggle settings modal

const {
	id: _id = "mobile-menu-button",
	modalId = "settings-modal",
	ariaLabel = "Open settings menu",
} = Astro.props;
---

<button
	type="button"
	id={_id}
	class="button is-hidden-desktop mobile-menu-button"
	aria-label={ariaLabel}
	aria-haspopup="dialog"
	aria-controls={modalId}
	aria-expanded="false"
	data-testid="mobile-menu-button"
>
	<span class="icon" aria-hidden="true">
		<svg
			class="hamburger-icon"
			width="24"
			height="24"
			viewBox="0 0 24 24"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
			aria-hidden="true"
		>
			<line x1="3" y1="6" x2="21" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
			<line x1="3" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
			<line x1="3" y1="18" x2="21" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
		</svg>
	</span>
	<span class="is-sr-only">Menu</span>
</button>

<style>
	.mobile-menu-button {
		position: fixed;
		top: 1rem;
		left: 1rem;
		z-index: 1000;
		width: 44px;
		height: 44px;
		padding: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		background-color: white;
		border: 1px solid #dbdbdb;
		border-radius: 6px;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		transition: all 0.2s ease;
	}

	.mobile-menu-button:hover {
		background-color: #f5f5f5;
		transform: scale(1.05);
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
	}

	.mobile-menu-button:active {
		transform: scale(0.95);
	}

	.mobile-menu-button:focus-visible {
		outline: 2px solid #485fc7;
		outline-offset: 2px;
	}

	.mobile-menu-button .icon {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
		color: #363636;
	}

	.hamburger-icon {
		display: block;
		width: 20px;
		height: 20px;
	}

	/* Screen reader only text */
	.is-sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}

	/* Adjust position on tablet */
	@media (min-width: 769px) and (max-width: 1024px) {
		.mobile-menu-button {
			top: 0.75rem;
			left: 0.75rem;
		}
	}

	/* Reduced motion support */
	@media (prefers-reduced-motion: reduce) {
		.mobile-menu-button,
		.mobile-menu-button:hover,
		.mobile-menu-button:active {
			transition: none;
			transform: none;
		}
	}
</style>

<script>
	// Wire up the mobile menu button to toggle the settings modal
	document.addEventListener('DOMContentLoaded', () => {
		const menuButton = document.getElementById('mobile-menu-button');
		const modal = document.getElementById('settings-modal') as HTMLDialogElement | null;

		if (menuButton && modal) {
			menuButton.addEventListener('click', () => {
				if (modal.open) {
					modal.close();
					menuButton.setAttribute('aria-expanded', 'false');
				} else {
					modal.showModal();
					menuButton.setAttribute('aria-expanded', 'true');
				}
			});

			// Update aria-expanded when modal is closed via other means
			modal.addEventListener('close', () => {
				menuButton.setAttribute('aria-expanded', 'false');
			});

			// Close modal when clicking outside
			modal.addEventListener('click', (e) => {
				if (e.target === modal) {
					modal.close();
				}
			});

			// Handle escape key
			modal.addEventListener('keydown', (e) => {
				if (e.key === 'Escape') {
					menuButton.setAttribute('aria-expanded', 'false');
				}
			});
		}
	});
</script>
