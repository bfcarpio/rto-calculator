---
// StatusDetails.astro - Display compliance status, capacity, and non-compliant weeks
// Placeholder data - real data integration comes in later phases

// Week Summary Data
const _bestWeeks = 8;
const _totalBestWeeks = 8;
const _averageDays = 3.2;
const _targetDays = 3;
const _maxDays = 5;

// Capacity Data
const _goodWeeks = 5;
const _weeksNeeded = 8;
const _oofWeeksAvailable = 3;

// Current Week Data
const _currentWeekStart = "Jan 27";
const _currentWeekEnd = "Feb 2";
const _currentWeekDaysWorked = 2;
const _currentWeekTarget = 3;

// Non-Compliant Weeks (placeholder)
interface NonCompliantWeek {
	weekRange: string;
	daysWorked: number;
	target: number;
}

const _nonCompliantWeeks: NonCompliantWeek[] = [
	{ weekRange: "Jan 13 - Jan 19", daysWorked: 1, target: 3 },
	{ weekRange: "Jan 6 - Jan 12", daysWorked: 2, target: 3 },
];

// Helper to determine status color
const _getStatusColor = (current: number, target: number): string => {
	if (current >= target) return "has-text-success";
	if (current >= target - 0.5) return "has-text-warning";
	return "has-text-danger";
};

const _complianceStatusClass = _averageDays >= _targetDays ? "has-text-success" : "has-text-warning";
---

<div class="status-details">
	<!-- Week Summary Box -->
	<div class="box week-summary">
		<h3 class="title is-6 mb-3">Week Summary</h3>
		<div class="content">
			<div class="level is-mobile mb-2">
				<div class="level-left">
					<p>In best {_totalBestWeeks} weeks:</p>
				</div>
				<div class="level-right">
					<p class={`has-text-weight-bold ${_complianceStatusClass}`}>
						{_bestWeeks}/{_totalBestWeeks}
					</p>
				</div>
			</div>

			<div class="level is-mobile mb-2">
				<div class="level-left">
					<p>Average:</p>
				</div>
				<div class="level-right">
					<p class={`has-text-weight-bold ${_getStatusColor(_averageDays, _targetDays)}`}>
						{_averageDays}/{_maxDays} days
					</p>
				</div>
			</div>

			<div class="level is-mobile">
				<div class="level-left">
					<p>Target:</p>
				</div>
				<div class="level-right">
					<p class="has-text-weight-bold has-text-primary">
						{_targetDays}/{_maxDays} days
					</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Capacity Box -->
	<div class="box capacity">
		<h3 class="title is-6 mb-3">Capacity</h3>
		<div class="content">
			<div class="level is-mobile mb-2">
				<div class="level-left">
					<p>Buffer:</p>
				</div>
				<div class="level-right">
					<p class="has-text-weight-bold has-text-info">
						Good weeks = {_goodWeeks} of {_weeksNeeded} needed
					</p>
				</div>
			</div>

			<div class="level is-mobile">
				<div class="level-left">
					<p>You can take:</p>
				</div>
				<div class="level-right">
					<p class="has-text-weight-bold has-text-success">
						{_oofWeeksAvailable} full weeks OOF
					</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Current Week Status Box -->
	<div class="box current-week">
		<h3 class="title is-6 mb-3">Current Week Status</h3>
		<div class="content">
			<p class="mb-2">
				<span class="has-text-weight-semibold">Week of:</span>
				{_currentWeekStart} - {_currentWeekEnd}
			</p>
			<div class="level is-mobile">
				<div class="level-left">
					<p>Days worked:</p>
				</div>
				<div class="level-right">
					<p class={`has-text-weight-bold ${_getStatusColor(_currentWeekDaysWorked, _currentWeekTarget)}`}>
						{_currentWeekDaysWorked}/{_currentWeekTarget}
					</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Non-Compliant Weeks Box -->
	<div class="box non-compliant">
		<h3 class="title is-6 mb-3">
			<span class="icon has-text-warning" aria-hidden="true">‚ö†Ô∏è</span>
			Non-Compliant Weeks
		</h3>
		<div class="content">
			{_nonCompliantWeeks.length === 0 ? (
				<div class="notification is-success is-light">
					<p class="has-text-centered">All weeks are compliant! üéâ</p>
				</div>
			) : (
				<div class="non-compliant-list">
					{_nonCompliantWeeks.map((week) => (
						<div class="notification is-warning is-light mb-2">
							<div class="is-flex is-justify-content-space-between is-align-items-center">
								<div>
									<p class="has-text-weight-semibold">{week.weekRange}</p>
									<p class="is-size-7">
										Only {week.daysWorked} of {week.target} days worked
									</p>
								</div>
								<span class="tag is-warning">Needs {week.target - week.daysWorked} more</span>
							</div>
						</div>
					))}
				</div>
			)}
		</div>
	</div>
</div>

<style>
	.status-details {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.status-details .box {
		margin-bottom: 0;
		padding: 1.25rem;
		transition: box-shadow 0.2s ease;
	}

	.status-details .box:hover {
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	}

	.status-details .title.is-6 {
		color: #363636;
		border-bottom: 1px solid #f5f5f5;
		padding-bottom: 0.5rem;
	}

	.status-details .content {
		margin-bottom: 0;
	}

	.status-details .level {
		margin-bottom: 0;
	}

	.status-details .level:not(:last-child) {
		margin-bottom: 0.5rem;
	}

	.non-compliant-list .notification {
		padding: 1rem;
	}

	.non-compliant-list .notification:not(:last-child) {
		margin-bottom: 0.75rem;
	}

	/* Mobile adjustments */
	@media (max-width: 768px) {
		.status-details .box {
			padding: 1rem;
		}

		.status-details .level.is-mobile {
			flex-direction: column;
			align-items: flex-start;
		}

		.status-details .level.is-mobile .level-right {
			margin-top: 0.25rem;
		}
	}
</style>
