---
import "/src/styles/utilities.css";

const {
	dayNumber,
	year,
	month,
	isSelected: _isSelected = false,
	selectionType = "",
} = Astro.props;

// Create full date string for this day
const date = new Date(year, month, dayNumber);
const _dateString = date.toLocaleDateString("en-US", {
	weekday: "long",
	year: "numeric",
	month: "long",
	day: "numeric",
});

// Selection type to human-readable label mapping
const selectionLabels: Record<string, string> = {
	"out-of-office": "Out of office",
};

// Get human-readable label for current selection
const _selectionLabel = selectionType
	? selectionLabels[selectionType]
	: "Unselected";

// Create a unique ID for this day cell
const _cellId = `day-cell-${year}-${month}-${dayNumber}`;

// Create ISO date string for data-date attribute (YYYY-MM-DD format)
const _isoDate = `${year}-${String(month + 1).padStart(2, "0")}-${String(dayNumber).padStart(2, "0")}`;
---

<td
    id={_cellId}
    class="calendar-day no-reduced-motion"
    role="gridcell"
    aria-label={`${_dateString}. ${_selectionLabel}`}
    aria-selected={_isSelected ? "true" : "false"}
    data-day={dayNumber}
    data-year={year}
    data-month={month}
    data-date={_isoDate}
    data-selected={_isSelected}
    data-selection-type={selectionType}
    data-testid="calendar-day"
    tabindex="0"
>
    <span class="day-number" aria-hidden="true">{dayNumber}</span>
    <span class="sr-only">{_dateString}</span>
</td>

<style>
    :root {
        --calendar-day-out-of-office: #1890ff;
        --calendar-day-hover-border: #555;
        --calendar-day-focus-outline: #1890ff;
    }

    .calendar-day {
        width: 2rem;
        height: 2rem;
        font-size: 0.9rem;
        vertical-align: middle;
        transition: all 0.2s ease;
        cursor: pointer;
        position: relative;
        text-align: center;
        padding: 0;
        border: 1px solid transparent;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        background-color: transparent;
    }

    .calendar-day:focus {
        outline: 2px solid var(--calendar-day-focus-outline);
        outline-offset: 2px;
        z-index: 2;
    }

    .calendar-day:focus:not(:focus-visible) {
        outline: none;
    }

    .calendar-day:focus-visible {
        outline: 2px solid var(--calendar-day-focus-outline);
        outline-offset: 2px;
    }

    .calendar-day:hover {
        box-shadow: 0 0 0 2px var(--calendar-day-hover-border) inset;
        border-color: var(--calendar-day-hover-border);
    }

    /* Selection states - color + visual indicators for accessibility */
    .calendar-day.selected.out-of-office {
        background-color: var(--calendar-day-out-of-office);
        border-color: var(--calendar-day-out-of-office);
        color: white;
        font-weight: 600;
    }

    .calendar-day.holiday {
        background-color: transparent;
        border: 2px solid var(--color-holiday);
        color: var(--color-holiday);
        font-weight: 600;
        position: relative;
    }

    /* When holiday is also selected/OOF, show holiday outline instead of filled background */
    .calendar-day.holiday.out-of-office,
    .calendar-day.holiday.selected {
        background-color: transparent !important;
        border: 2px solid var(--color-holiday) !important;
        color: var(--color-holiday) !important;
    }

    .calendar-day.holiday::after {
        content: "ðŸŽ„";
        position: absolute;
        top: 1px;
        right: 1px;
        font-size: 0.6em;
        opacity: 0.8;
        pointer-events: none;
    }

    .calendar-day.holiday[title] {
        cursor: help;
    }

    /* Today highlight */
    .calendar-day.today {
        border-color: var(--calendar-day-focus-outline);
        box-shadow: 0 0 0 2px var(--calendar-day-focus-outline);
        font-weight: bold;
        position: relative;
    }

    .day-number {
        display: inline-block;
        width: 100%;
        height: 100%;
        line-height: 2rem;
        pointer-events: none;
    }

    .calendar-day.empty {
        background-color: #f9f9f9;
        pointer-events: none;
    }
</style>
