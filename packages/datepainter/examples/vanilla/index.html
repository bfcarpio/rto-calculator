<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Datepainter - Vanilla JS Example</title>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #1f2937;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 2rem;
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    p {
      color: #6b7280;
      margin-bottom: 2rem;
    }

    #calendar-container {
      margin-bottom: 2rem;
    }

    .info {
      background: #f9fafb;
      padding: 1.5rem;
      border-radius: 8px;
    }

    .info h2 {
      margin-top: 0;
      font-size: 1.25rem;
    }

    #selected-dates {
      min-height: 40px;
    }

    .date-chip {
      padding: 4px 8px;
      border-radius: 4px;
      margin: 2px;
      display: inline-block;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <main>
    <h1>Datepainter - Vanilla JS Example</h1>
    <p>Click on dates to select them. Click again to deselect.</p>

    <div id="calendar-container"></div>

    <div class="info">
      <h2>Selected Dates</h2>
      <div id="selected-dates">No dates selected</div>
    </div>
  </main>

  <script type="module">
    import { CalendarRenderer } from '../src/vanilla/index.js';
    import { setDateState, clearDateState, getAllDates } from '../src/stores/calendarStore.js';
    import { formatDate } from '../src/lib/dateUtils.js';

    const config = {
      dateRange: {
        start: new Date('2026-01-01'),
        end: new Date('2026-12-31')
      },
      states: {
        working: {
          label: 'Working',
          color: '#10b981',
          bgColor: '#d1fae5',
          icon: 'ðŸ’¼'
        },
        oof: {
          label: 'OOF',
          color: '#ef4444',
          bgColor: '#fee2e2',
          icon: 'ðŸ '
        },
        holiday: {
          label: 'Holiday',
          color: '#f59e0b',
          bgColor: '#fef3c7',
          icon: 'ðŸ–ï¸'
        }
      },
      styling: {
        cellSize: 48,
        showWeekdays: true,
        showWeekNumbers: true,
        firstDayOfWeek: 1
      },
      painting: {
        enabled: true,
        paintOnDrag: true,
        defaultState: 'working'
      }
    };

    const configStates = {
      working: { color: '#10b981', bgColor: '#d1fae5' },
      oof: { color: '#ef4444', bgColor: '#fee2e2' },
      holiday: { color: '#f59e0b', bgColor: '#fef3c7' }
    };

    let currentPaintState = 'working';
    const stateOrder = ['working', 'oof', 'holiday', ''];

    function updateSelectedDatesDisplay() {
      const container = document.getElementById('selected-dates');
      if (!container) return;

      const dates = getAllDates();
      const dateArray = Array.from(dates.entries())
        .sort((a, b) => a[0].localeCompare(b[0]));

      if (dateArray.length === 0) {
        container.textContent = 'No dates selected';
        return;
      }

      container.innerHTML = dateArray.map(([date, state]) => {
        const stateConfig = configStates[state];
        return `
          <span class="date-chip" style="
            background-color: ${stateConfig?.bgColor};
            color: ${stateConfig?.color};
          ">
            ${date} (${state})
          </span>
        `;
      }).join('');
    }

    function handleDayClick(dayEl) {
      const date = dayEl.dataset.date;
      if (!date) return;

      const currentState = getAllDates().get(date);
      const currentIndex = stateOrder.indexOf(currentState);
      const nextIndex = (currentIndex + 1) % stateOrder.length;
      const newState = stateOrder[nextIndex];

      if (newState) {
        setDateState(date, newState);
        dayEl.classList.add(`rto-calendar-day--${newState}`);
      } else {
        clearDateState(date);
        stateOrder.slice(0, -1).forEach(s => {
          dayEl.classList.remove(`rto-calendar-day--${s}`);
        });
      }

      updateSelectedDatesDisplay();
    }

    // Create and render calendar
    const renderer = new CalendarRenderer('#calendar-container', config);
    renderer.render();

    // Set up event delegation
    const calendar = document.querySelector('.rto-calendar');
    if (calendar) {
      calendar.addEventListener('click', (e) => {
        const target = e.target;
        const dayEl = target.closest('.rto-calendar-day');

        if (dayEl && !dayEl.classList.contains('rto-calendar-day--empty')) {
          handleDayClick(dayEl);
        }
      });
    }
  </script>
</body>
</html>
